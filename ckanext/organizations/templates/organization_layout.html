<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:i18n="http://genshi.edgewall.org/i18n"
  xmlns:py="http://genshi.edgewall.org/"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  py:strip=""
  >

  <py:match path="minornavigation">
    <ul py:if="c.group" class="tabbed">
      <li py:attrs="{'class':'current-tab'} if c.action=='read' else {}">${h.subnav_named_route(c, h.icon('group') + _('View'), 'organization_read',controller='group', action='read', id=c.group.name)}</li>
      <li py:attrs="{'class':'current-tab'} if c.action=='history' else {}">${h.subnav_named_route(c, h.icon('page_white_stack') + _('History'),  'organization_action', controller='group', action='history', id=c.group.name)}</li>
      <?python
        user_can_add = c.userobj and c.group in c.userobj.get_groups()
      ?>
      <span class="divider" py:if="user_can_add">&nbsp;&nbsp;|&nbsp;&nbsp;</span>
      <li py:if="user_can_add">
            <a href="${h.url_for(controller='package', action='new')}?groups__0__id=${c.group.id}">${h.icon('add') + _('Add Dataset')}</a>
      </li>
      <li py:attrs="{'class':'current-tab'} if c.action=='edit' else {}" py:if="h.check_access('group_update',{'id':c.group.id})">
        <!-- TODO: We need to be able to change the URL below based on the type of the group -->
        ${h.subnav_named_route( c,h.icon('group_edit') + _('Edit'), 'organization_action', action='edit', id=c.group.name )}
      </li>
      <li py:attrs="{'class':'current-tab'} if c.action=='authz' else {}" py:if="h.check_access('group_edit_permissions',{'id':c.group.id})">
        ${h.subnav_named_route(c, h.icon('lock') + _('Authorization'), 'organization_action', controller='group', action='authz', id=c.group.name)}
      </li>

      <!-- li class="action">
      ${h.subnav_link(c, h.icon('atom_feed') + _('Subscribe'),
      controller='group', action='history', id=c.group.name, format='atom', days=7)}
      </li-->
    </ul>
    <ul py:if="not c.group" class="tabbed">
      <li py:attrs="{'class':'current-tab'} if c.action=='index' else {}">
        ${h.subnav_named_route(c, h.icon('group') + _('List organizations'), "organization_index", action="index" )}
      </li>
      <li py:attrs="{'class':'current-tab'} if c.action=='new' else {}">        <span class="ckan-logged-in" style="display: none;">${ h.subnav_named_route(c, h.icon('group_add') + _('Add an organization'), "organization_new" , action='new')}</span>
        <span class="ckan-logged-out">${h.subnav_link(c, h.icon('group_add') + _('Login to Add an organization'), controller='group', action='new')}</span>
      </li>
    </ul>
  </py:match>

  <xi:include href="layout.html" />
</html>

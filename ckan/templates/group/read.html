{% extends "page.jinja.html" %}

{% block title %}{{ c.group_dict.display_name }} - {{ super() }}{% endblock %}

{% block breadcrumb %}
  <ol class="breadcrumb">
    <li>{{ h.nav_link(_('Groups'), controller='group', action='index') }}</li>
    <li class="current">{{ h.nav_link(c.group_dict.display_name, controller='group', action='read', id=c.group_dict.name) }}</li>
  </ol>
{% endblock %}

{% block actions %}
  <ul class="actions">
    <li>{{ h.nav_link(_('History'), controller='group', action='history', id=c.group_dict.name, class_='btn', icon='rewind') }}</li>
  </ul>
{% endblock %}

{% block primary_content %}
  <section class="module">
    <div class="content">
      <form id="dataset-search" class="dataset-search clearfix" method="GET">
        <span class="control-group search-giant">
          <input type="text" class="search" name="q" value="{{ c.q }}" autocomplete="off" results="0" placeholder="{{ _('Search...') }}" />
          <button type="submit" value="{{ _('Search') }}">Submit</button>
        </span>
        {{ h.snippet('snippets/sort_by.html', sort=c.sort_by_selected) }}
        {% if c.fields %}
          <span py:if="c.fields">
            {% for key, value in c.fields %}
              <input type="hidden" name="{{ key }}" value="{{ value }}" />
            {% endfor %}
          </span>
        {% endif %}
        <div id="dataset-search-ext"></div>
      </form>
      <div class="results">
        <strong>
          {% if request.params and c.page.item_count %}
            {{ c.page.item_count }} datasets{% if c.q %} found for &#147;{{ c.q }}&#148;{% endif %}
          {% elif request.params and c.page.item_count == 0 %}
            Sorry no datasets found{% if c.q %} for &#147;{{ c.q }}&#148;{% endif %}
          {% else %}
            All datasets
          {% endif %}
        </strong>
        <div class="filter-list">
          {% for field in c.fields_grouped %}
          <span class="facet">{{ c.facet_titles.get(field) }}:</span>
            {% for value in c.fields_grouped[field] %}
              <span class="filtered pill">
                {% if c.translated_fields and c.translated_fields.has_key((field,value)) %}
                  {{ c.translated_fields[(field,value)] }}
                {% else %}
                  {{ value }}
                {% endif %}
                <a href="${c.remove_field(field, value)}" class="remove icon-remove icon-white">[remove]</a>
              </span>
            {% endfor %}
          {% endfor %}
          {% if request.params and c.q and c.page.item_count == 0 %}
            <p class="extra">Try another search term,
            browse the datasets below or <a href="{{ h.url_for(action='new', id=None) }}">add your own data</a>.</p>
          {% endif %}
        </div>
      </div>

      {% if c.query_error %}
        <p><strong>There was an error while searching.</strong> Please try again.</p>
      {% endif %}
      {{ h.snippet('snippets/package_list.html', packages=c.page.items) }}
    </div>
    {{ c.page.pager(q=c.q) }}
  </section>
{% endblock %}

{% block secondary_content %}
  <section class="module info group">
    <div class="content media media-vertical">
      <a class="image" href="{{ h.url_for(controller='group', action='read', id=c.group_dict.name) }}">
        <img src="{{ c.group_dict.image_url or '/base/images/placeholder-group.png' }}" width="200" height="125" />
      </a>
      <div class="content">
        <a href="{{ h.url_for(controller='group', action='read', id=c.group_dict.name) }}">
          <h3>{{ c.group_dict.display_name }}</h3>
        </a>
        {% if c.group_dict.description %}
          <p>{{ c.group_dict.description }}</p>
        {% else %}
          <p class="empty">{{ _('There is no description for this group') }}</p>
        {% endif %}
      </div>
    </div>
  </section>

  <section class="module info">
    <h2 class="heading"><i class="ckan-icon ckan-icon-head"></i> {{ _('Administrators') }}</h2>
    <ul class="nav nav-simple">
      {% for admin in c.group_admins %}
        <li class="image">{{ h.linked_user(admin, 30) }}</li>
      {% endfor %}
    </ul>
  </section>

  {{ h.snippet('snippets/facet_list.html', title='Tags', name='tags') }}
  {{ h.snippet('snippets/facet_list.html', title='Formats', name='res_format') }}
{% endblock %}

{% block links %}
  {{ super() }}
  {% include "group/partials/feeds.html" %}
{% endblock %}

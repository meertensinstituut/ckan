<!DOCTYPE html>
<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:i18n="http://genshi.edgewall.org/i18n"
  xmlns:py="http://genshi.edgewall.org/"
  xmlns:xi="http://www.w3.org/2001/XInclude">
    <!--! Include matchers nearest first -->
    <xi:include href="../page.html" />

    <!--! Now include the current page -->
    <head>
      <title>Search for a Dataset</title>
    </head>
    <body>
      <nav class="toolbar">
        <ol class="breadcrumb">
          <li class="active">${h.nav_link(_('Search Datasets'), controller='package', action='search', highlight_actions = 'new index')}</li>
        </ol>
      </nav>

      <div class="primary">
        <section class="module">
          <div class="content">
            <form id="dataset-search" class="dataset-search clearfix" method="GET">
              <span class="control-group search-giant">
                <input type="text" class="search" name="q" value="${c.q}" autocomplete="off" results="0" placeholder="${_('Search...')}" />
                <button type="submit" value="${_('Search')}">Submit</button>
              </span>
              ${h.snippet('snippets/sort_by.html', sort=c.sort_by_selected)}
              <span py:if="c.fields">
                <py:for each="(k, v) in c.fields">
                  <input type="hidden" name="${k}" value="${v}" />
                </py:for>
              </span>
              <div id="dataset-search-ext"></div>
            </form>
            <div class="results">
              <strong py:choose="">
                <py:when test="request.params and c.page.item_count">${c.page.item_count} datasets<py:if test="c.q"> found for &#147;${c.q}&#148;</py:if></py:when>
                <py:when test="request.params and c.page.item_count == 0">Sorry no datasets found for &#147;${c.q}&#148;</py:when>
                <py:otherwise>All datasets</py:otherwise>
              </strong>
              <div class="filter-list">
                <py:for each="field in c.fields_grouped">
                  <span class="facet">${c.facet_titles.get(field)}:</span>
                  <py:for each="value in c.fields_grouped[field]">
                    <span class="filtered pill" py:choose="">
                      <py:when test="c.translated_fields and c.translated_fields.has_key((field,value))">
                      ${c.translated_fields[(field,value)]}
                      </py:when>
                      <py:otherwise>${value}</py:otherwise>
                      <a href="${c.remove_field(field, value)}" class="remove icon-remove icon-white">[remove]</a>
                    </span>
                  </py:for>
                </py:for>
                <p class="extra" py:if="request.params and c.page.item_count == 0">Try another search term,
                browse the datasets below or <a href="${h.url_for(action='new', id=None)}">add your own data</a>.</p>
              </div>
            </div>

            <py:if test="c.query_error">
              <p i18n:msg="item_count"><strong>There was an error while searching.</strong>
              Please try again.</p>
            </py:if>
            ${h.snippet('snippets/package_list.html', packages=c.page.items)}
          </div>
          ${c.page.pager(q=c.q)}
        </section>

        <section class="module info">
          <small class="content">
            You can also access this registry using the ${h.link_to(_('API'), h.url_for(controller='api', action='get_api', ver=1))}
            <!--! FIXME the API Docs link should be for the version of ckan being used but the dev version of ckan needs to point to latest so not trivial -->
            (see ${h.link_to(_('API Docs'), 'http://docs.ckan.org/en/latest/api.html')})
            <py:if test="config.get('ckan.dumps_url')">or download a <a href="${config.get('ckan.dumps_url')}">full ${config.get('ckan.dumps_format', '')} dump</a></py:if>.
          </small>
        </section>
      </div>
      <div class="secondary">
        ${h.snippet('snippets/facet_list.html', title='Tags', name='tags')}
        ${h.snippet('snippets/facet_list.html', title='Formats', name='res_format')}
        ${h.snippet('snippets/facet_list.html', title='Groups', name='groups')}
      </div>
    </body>
</html>

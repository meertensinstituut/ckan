<!DOCTYPE html>
<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:i18n="http://genshi.edgewall.org/i18n"
  xmlns:py="http://genshi.edgewall.org/"
  xmlns:xi="http://www.w3.org/2001/XInclude">
    <!--! Include matchers nearest first -->
    <xi:include href="../page.html" />

    <!--! Now include the current page -->
    <head>
      <title>Search for a Dataset</title>
    </head>
    <body>
      <div class="primary">
        <section class="module">
          <div class="content">
            <form id="dataset-search" class="dataset-search clearfix" method="GET">
              <span class="search-giant">
                <input type="text" class="search" name="q" value="${c.q}" autocomplete="off" results="0" placeholder="${_('Search...')}" />
                <button type="submit" value="${_('Search')}">Submit</button>
              </span>
              <span py:if="c.fields">
                <py:for each="(k, v) in c.fields">
                  <input type="hidden" name="${k}" value="${v}" />
                </py:for>
              </span>
              <div id="dataset-search-ext"></div>
            </form>
            <div class="filter-list">
              <strong py:choose="" class="results">
                <py:when test="request.params">${c.page.item_count} datasets<py:if test="c.q"> found for &#147;${c.q}&#148;</py:if></py:when>
                <py:otherwise>All datasets</py:otherwise>
              </strong>
              <py:for each="(field, value) in c.fields">
                <span class="facet">${h.facet_title(field)}:</span>
                <span class="filtered pill" py:choose="">
                  <py:when test="c.translated_fields and c.translated_fields.has_key((field,value))">
                    ${c.translated_fields[(field,value)]}
                  </py:when>
                  <py:otherwise>${value}</py:otherwise>
                  <a href="${c.remove_field(field, value)}" class="remove icon-remove icon-white">[remove]</a>
                </span>
              </py:for>  
            </div>
            <py:if test="c.query_error">
              <p i18n:msg="item_count"><strong>There was an error while searching.</strong>
              Please try again.</p>
            </py:if>
            <py:if test="c.page.item_count == 0 and request.params">
              <p i18n:msg="">Would you like to <a href="${h.url_for(action='new', id=None)}">create a new dataset?</a></p>
            </py:if>
            ${h.snippet('snippets/package_list.html', packages=c.page.items)}
          </div>
          ${c.page.pager(q=c.q)}
        </section>

        <section class="module info">
          <small class="content">
            You can also access this registry using the ${h.link_to(_('API'), h.url_for(controller='api', action='get_api', id=None, ver=1))}
            (see ${h.link_to(_('API Docs'), 'http://docs.ckan.org/en/latest/api.html')})
            <py:if test="config.get('ckan.dumps_url')">or download a <a href="${config.get('ckan.dumps_url')}">full ${config.get('ckan.dumps_format', '')} dump</a></py:if>.
          </small>
        </section>
      </div>
      <div class="secondary">
        ${h.snippet('snippets/facet_list.html', title='Tags', name='tags', limit=10)}
        ${h.snippet('snippets/facet_list.html', title='Formats', name='res_format', limit=10)}
        ${h.snippet('snippets/facet_list.html', title='Groups', name='groups', limit=10)}
      </div>
    </body>
</html>

{% extends "page.html" %}

{% block title %}{{ h.dataset_display_name(c.package) }} - {{ h.resource_display_name(c.resource) }} - {{ super() }}{% endblock %}

{% block breadcrumb %}
  <ol class="breadcrumb">
    <li>{{ h.nav_link(_('Datasets'), controller='package', action='search', highlight_actions = 'new index') }}</li>
    <li>{{ h.nav_link(h.dataset_display_name(c.package), controller='package', action='read', id=c.package.get('name')) }}</li>
    <li class="active"><a href="">{{ h.resource_display_name(c.resource) }}</a></li>
  </ol>
{% endblock %}

{% block actions %}
  <ul class="actions">
    {% if c.resource.url %}
      <li>
        <a class="btn resource-url-analytics resource-type-{{ c.resource.resource_type }}" href="{{ c.resource.url }}">
          {% if c.resource.resource_type in ('listing', 'service') %}
            {{ _('View') }}
          {% elif  c.resource.resource_type == 'api' %}
            {{ _('API Endpoint') }}
          {% else %}
            <i class="ckan-icon ckan-icon-download"></i> Download
          {%endif %}
        </a>
      </li>
    {% endif %}
    {% if config.get('ckan.datastore.enabled', false) %}
      <li>
        {% if c.resource.webstore_url %}
          <a class="btn" data-toggle="modal" href="#modal-data-api-help"><i class="ckan-icon ckan-icon-star"></i> {{ _('Data API') }}</a>
        {% else %}
          <a class="btn disabled" rel="tooltip" title="{{ _('Data API is unavailable for this resource as DataStore is disabled') }}"><i class="ckan-icon ckan-icon-star"></i> {{ _('Data API') }}</a>
        {% endif %}
      </li>
    {% endif %}
  </ul>
{% endblock %}

{% block primary_content %}
  <section class="module">
    <div class="content">
      <h1>{{ h.resource_display_name(c.resource) }}</h1>

      <div class="notes" property="rdfs:label">
        {{ c.resource.get('description') or '(No description)' }}
        {% if not c.resource.description and c.package.notes %}
          <div>{{ h.markdown_extract(c.package.get('notes')) }}</div>
          <small>From the <a href="{{ h.url_for(controller='package', action='read', id=c.package['name']) }}">Dataset</a></small>
        {% endif %}
      </div>
    </div>
    <div class="resource-preview content">
      <div class="preview-header">
        <h3>Preview</h3>
        {% if c.pkg.is_private %}
          <a title="Cannot embed as resource is private." style="display: none;" class="btn disabled" data-toggle="modal" href=".modal-data-viewer-embed-dialog">Embed</a>
        {% else %}
          <a style="display: none;" class="btn btn-primary" data-toggle="modal" href=".modal-data-viewer-embed-dialog">Embed</a>
        {% endif %}
      </div>
      <div id="ckanext-datapreview content"></div>
    </div>
  </section>

  <section class="module">
    <div class="content">
      <h2>Additional Information</h2>
      <table class="table table-striped table-bordered table-condensed">
        <thead>
          <tr>
            <th>Field</th>
            <th>Value</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th>Last Updated</th>
            <td>{{ h.time_ago_in_words_from_str(c.resource['last_modified'], granularity='day') }}</td>
          </tr>
          <tr>
            <th>Licence</th>
            <td>{{ h.snippet('snippets/license.html', pkg_dict=c.pkg_dict, text_only=True) }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>

  {% if config.get('ckan.datastore.enabled', false) %}
    <section class="module">
      {{ data_api_help(c.datastore_api) }}
    </section>
  {% endif %}
{% endblock %}

{% block secondary_content %}
  <section class="module">
    <h2 class="heading"><i class="ckan-icon ckan-icon-info"></i> Resource Information</h2>
    <ul class="simple-list">
      <li><i class="ckan-icon ckan-icon-calendar"></i> Unknown</li>
      <li><i class="ckan-icon ckan-icon-file"></i> CSV</li>
      <li><i class="ckan-icon ckan-icon-lock"></i> {{ h.snippet('snippets/license.html', pkg_dict=c.pkg_dict, text_only=True) }}</li>
    </ul>
  </section>

  {{ h.snippet('snippets/social.html') }}
{% endblock %}

<html xmlns:py="http://genshi.edgewall.org/"
  xmlns:i18n="http://genshi.edgewall.org/i18n"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  xmlns:foaf="http://xmlns.com/foaf/0.1/"
  xmlns:owl="http://www.w3.org/2002/07/owl#"
  xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#"
  xmlns:dc="http://purl.org/dc/terms/"
  xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
  xmlns:dcat="http://www.w3.org/ns/dcat#"
  typeof="dcat:Dataset"
  about=""
  py:strip="">

  <py:def function="optional_head">
    <!-- data preview -->
    <link rel="stylesheet" href="${g.site_url}/scripts/vendor/slickgrid/slick.grid.css" />
    <link rel="stylesheet" href="${g.site_url}/scripts/vendor/slickgrid/slick.columnpicker.css" />
    <link rel="stylesheet" href="http://okfn.github.com/dataexplorer/src/table-view.css" />
    <!-- /data preview -->
  </py:def>

  <py:def function="page_title">
    <py:if test="c.resource.get('name')">
      ${c.package.get('title', c.package['name'])} &gt;
      ${c.resource.get('name')} - Datasets
    </py:if>
    <py:if test="not c.resource.get('name')">
      ${c.package.get('title', c.package['name'])} &gt;
      ${c.resource.get('id')} - Datasets
    </py:if>
  </py:def>

  <py:def function="page_heading">
    <py:if test="c.resource.get('name')">
      ${c.resource.get('name')}
    </py:if>
    <py:if test="not c.resource.get('name')">
      ${c.resource.get('id')}
    </py:if>
  </py:def>

  <div py:match="content">
    <div id="resource-main-information">
      <div id="resource-dataset">
        Dataset:
        <span id="dataset-title" property="dc:title">
          <a href="${h.url_for(controller='package', action='read', id=c.package['name'])}">
            ${c.package.get('title', c.package['name'])} 
          </a>
        </span>
        <span id="dataset-license">
          <py:if test="c.package['isopen']">
              <a href="http://opendefinition.org/okd/" title="This dataset satisfies the Open Definition.">
                <img src="http://assets.okfn.org/images/ok_buttons/od_80x15_blue.png" alt="[Open Data]" />
              </a>
          </py:if>
          <py:if test="not c.package['isopen']">
              <span class="closed">
                ${h.icon('lock')}
              </span>
          </py:if>
        </span>
      </div>
      <div py:if="c.resource.get('last_modified')" id="resource-last-updated">
        Last updated: ${h.time_ago_in_words_from_str(c.resource.get('last_modified'), granularity='day')}
      </div>
    </div>

    <div id="resource-actions">
      <a py:if="c.resource.get('url')" class="pretty-button" href="${c.resource.get('url')}">
        <py:choose test="c.resource.get('resource_type')">
          <py:when test="'listing'">View</py:when>
          <py:when test="'service'">View</py:when>
          <py:when test="'api'">API Endpoint</py:when>
          <py:otherwise>Download</py:otherwise>
        </py:choose>
        </a>
    </div>

    <div py:if="c.resource.get('description')" id="resource-description" property="rdfs:label">
      ${c.resource.get('description')}
    </div>

    <div py:if="not c.resource.get('description') and c.package.get('notes')" id="dataset-description">
      <div>
        <strong>
          From the <a href="${h.url_for(controller='package', action='read', id=c.package['name'])}">Dataset</a>:
        </strong>
      </div>
      <div>${h.markdown_extract(c.package.get('notes'), 300)}</div>
    </div>

    <!-- TODO: hide this div if not available -->
    <!-- <div id="resource-explore"> -->
    <!--   <h2>Explore</h2> -->
    <!--   <div> -->
    <!--     TODO: data preview here -->
    <!--   </div> -->
    <!-- </div> -->

    <div id="resource-information">
      <h3>Information</h3>
      <table>
        <tbody>
          <tr>
            <td class="label">Url</td>
            <td class="details">
              <a href="${c.resource.get('url')}" rel="dcat:accessURL" target="_blank">
                <span property="rdfs:label">${c.resource.get('url')}</span>
              </a>
            </td>
          </tr>

          <tr>
            <td class="label">Format</td>
            <td><span property="dc:format">${c.resource.get('format', "(none)")}</span></td>
          </tr>

          <tr py:if="c.resource.get('resource_type')">
            <td class="label">Resource Type</td>
            <td><span property="dc:format">${c.resource.get('resource_type', "(none)")}</span></td>
          </tr>

          <tr py:if="c.resource.get('size')">
            <td class="label">Size (Bytes)</td>
            <td>${c.resource.get('size')}</td>
          </tr>

          <tr py:if="c.resource.get('mimetype')">
            <td class="label">Mimetype</td>
            <td>${c.resource.get('mimetype')}</td>
          </tr>

          <tr py:if="c.resource.get('mimetype_inner')">
            <td class="label">Mimetype (Inner)</td>
            <td>${c.resource.get('mimetype_inner')}</td>
          </tr>

          <tr py:if="c.resource.get('hash')">
            <td class="label">Hash</td>
            <td>${c.resource.get('hash')}</td>
          </tr>

          <tr> 
            <td class="label">ID</td>
            <td>${c.resource.get('id')}</td>
          </tr>
        </tbody>
      </table>

    </div>
  </div>

  <py:def function="optional_footer">
    <!-- data preview -->
    <script type="text/javascript" src="${g.site_url}/scripts/vendor/jquery.event.drag/2.0/jquery.event.drag.min.js"></script>
    <script type="text/javascript" src="${g.site_url}/scripts/vendor/slickgrid/slick.grid.js"></script>
    <script type="text/javascript" src="${g.site_url}/scripts/vendor/slickgrid/slick.columnpicker.js"></script>
    <script type="text/javascript" src="${g.site_url}/scripts/vendor/flot/0.7/jquery.flot.js"></script>
    <script src="https://github.com/okfn/dataexplorer/raw/master/src/table-view.js"></script>
    <script src="https://github.com/okfn/dataexplorer/raw/master/src/table-view.ui.js"></script>
    <script src="https://github.com/okfn/dataexplorer/raw/master/src/table-view-template.js"></script>
    <!-- local copy, symlinked from your local checkout for dev purposes (to be removed at some point)
    <script src="${g.site_url}/scripts/vendor/dataexplorer/table-view.js"></script>
    <script src="${g.site_url}/scripts/vendor/dataexplorer/table-view.ui.js"></script>
    <script src="${g.site_url}/scripts/vendor/dataexplorer/table-view-template.js"></script>
         /data preview -->
  </py:def>

  <xi:include href="layout.html" />
</html>

